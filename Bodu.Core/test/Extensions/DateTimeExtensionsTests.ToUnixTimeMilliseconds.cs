// ---------------------------------------------------------------------------------------------------------------
// <auto-generated />
// ---------------------------------------------------------------------------------------------------------------

using System;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using Bodu.Extensions;

namespace Bodu.Extensions
{
	public partial class DateTimeExtensionsTests
	{

		[DataTestMethod]
		[DataRow("1970-01-01T00:00:00Z", 0)]                   // epoch
		[DataRow("1970-01-01T00:00:01Z", 1000)]                // +1 second
		[DataRow("1970-01-01T00:01:00Z", 60_000)]              // +1 min
		[DataRow("1970-01-01T01:00:00Z", 3_600_000)]           // +1 hour
		[DataRow("1969-12-31T23:59:59Z", -1000)]               // -1 second
		[DataRow("1969-12-31T23:59:00Z", -60_000)]             // -1 min
		public void ToUnixTimeMilliseconds_WhenCalledWithUtc_ShouldReturnExpected(string inputDate, long expected)
		{
			DateTime input = DateTime.Parse(inputDate).ToUniversalTime();

			long result = input.ToUnixTimeMilliseconds();

			Assert.AreEqual(expected, result);
		}

		[TestMethod]
		public void ToUnixTimeMilliseconds_WhenKindIsUtc_ShouldReturnCorrectMilliseconds()
		{
			DateTime input = new DateTime(1970, 1, 1, 0, 0, 1, DateTimeKind.Utc); // +1 sec
			long result = input.ToUnixTimeMilliseconds();

			Assert.AreEqual(1000, result);
		}

		[TestMethod]
		public void ToUnixTimeMilliseconds_WhenKindIsLocal_ShouldConvertToUtc()
		{
			DateTime utc = new DateTime(2024, 4, 18, 12, 0, 0, DateTimeKind.Utc);
			DateTime local = utc.ToLocalTime();
			long expected = utc.ToUnixTimeMilliseconds();

			long result = local.ToUnixTimeMilliseconds();

			Assert.AreEqual(expected, result);
		}

		[TestMethod]
		public void ToUnixTimeMilliseconds_WhenKindIsUnspecified_ShouldAssumeLocalTime()
		{
			DateTime localNow = DateTime.Now;
			DateTime unspecified = DateTime.SpecifyKind(localNow, DateTimeKind.Unspecified);

			long resultUnspecified = unspecified.ToUnixTimeMilliseconds();
			long resultLocal = localNow.ToUnixTimeMilliseconds();

			// Allow small difference due to processing time
			Assert.IsTrue(Math.Abs(resultUnspecified - resultLocal) < 1000);
		}

		[TestMethod]
		public void ToUnixTimeMilliseconds_WhenUsingMinValue_ShouldBeNegativeLarge()
		{
			long result = DateTime.MinValue.ToUnixTimeMilliseconds();

			Assert.IsTrue(result < 0);
		}

		[TestMethod]
		public void ToUnixTimeMilliseconds_WhenUsingMaxValue_ShouldBePositiveLarge()
		{
			long result = DateTime.MaxValue.ToUnixTimeMilliseconds();

			Assert.IsTrue(result > 0);
		}

		[TestMethod]
		public void ToUnixTimeMilliseconds_RoundTripWithFromUnixTimeMilliseconds_ShouldMatchUtc()
		{
			DateTime input = new DateTime(2024, 4, 18, 14, 0, 0, DateTimeKind.Utc);
			long millis = input.ToUnixTimeMilliseconds();

			DateTime roundTrip = DateTimeExtensions.FromUnixTimeMilliseconds(millis);

			Assert.AreEqual(input, roundTrip);
		}
	}
}
